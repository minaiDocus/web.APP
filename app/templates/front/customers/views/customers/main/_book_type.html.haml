.modal#journals-customer
  .modal-dialog
    .modal-content
      .modal-header
        %h5.modal-title.bold Paramètrage: journaux comptables
        %button.btn-close{'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', :type => 'button'}
      .modal-body
        .form-group
          - if @organization.specific_mission
            %table.table.table-striped
              %thead
                %th Code dossier
                %th Nom dossier
                %th Nombre d’automates
                - if (@user.leader? || @user.organization_rights_is_customer_journals_management_authorized) && @customer.active?
                  %th Actions
              %tbody
                - @customer.account_book_types.each do |journal|
                  %tr
                    %td= journal.name
                    %td= journal.description
                    %td= journal.retrievers.count
                    - if (@user.leader? || @user.organization_rights_is_customer_journals_management_authorized) && @customer.active?
                      %td.text-end.pointer
                        .action.sub_edit_delete.list-collaborators
                          %span.glyph= glyphicon('ellipses', { size: '15', color: 'rgba(26, 26, 26, 0.7);', style: 'transform: rotate(90deg)'})
                        .sub_menu.text-start.hide
                          %ul.no-margin.no-padding.regular
                            %li.edit
                              = link_to glyphicon('pencil', { size: '15', color: 'rgba(26, 26, 26, 0.7);'}) + ' ' + t('actions.edit'), edit_organization_customer_journal_path(@organization, @customer, journal)
                        - if @user.is_admin || false || journal.is_open_for_modification?
                          %li.delete.red-label
                            = link_to glyphicon('trash', { size: '15', color: "#FF4848" }) + ' Supprimer', organization_customer_journal_path(@organization, @customer, journal), method: 'delete', data: { confirm: t('actions.confirm') }
                            - unless @user.is_admin || false
                              %i (pour #{distance_of_time_in_words_to_now(journal.created_at + 24.hours)})
          - else
            %table.table.table-striped
              %thead
                %th Nom journal comptable
                %th Code
                %th Par défaut ?
                %th Type de pré-saisie
                %th Type de compte
                %th Compte tiers
                %th Compte de charge/produit
                %th Nombre d’automates
                - if (@user.leader? || @user.organization_rights_is_customer_journals_management_authorized) && @customer.active?
                  %th Actions
              %tbody
                - @customer.account_book_types.each do |journal|
                  %tr
                    %td= journal.description
                    %td= journal.name
                    %td= journal.is_default ? 'Oui' : 'Non'
                    %td= t("activerecord.models.account_book_type.attributes.entry_type_#{journal.entry_type}")
                    %td
                      - if journal.is_pre_assignment_processable?
                        = journal.default_account? ? 'compte par défaut' : "compte d'attente"
                    %td= journal.meta_account_number
                    %td= journal.meta_charge_account
                    %td= journal.retrievers.count
                    - if (@user.leader? || @user.organization_rights_is_customer_journals_management_authorized) && @customer.active?
                      %td.text-end.pointer
                        .action.sub_edit_delete.list-collaborators
                          %span.glyph= glyphicon('ellipses', { size: '15', color: 'rgba(26, 26, 26, 0.7);', style: 'transform: rotate(90deg)'})
                        .sub_menu.text-start.hide
                          %ul.no-margin.no-padding.regular
                            %li.edit
                              = link_to glyphicon('pencil', { size: '15', color: 'rgba(26, 26, 26, 0.7);'}) + ' ' + t('actions.edit'), edit_organization_customer_journal_path(@organization, @customer, journal)
                            - if @user.is_admin || false || journal.is_open_for_modification?
                              %li.delete.red-label
                                = link_to glyphicon('trash', { size: '15', color: "#FF4848" }) + ' Supprimer', organization_customer_journal_path(@organization, @customer, journal), method: 'delete', data: { confirm: t('actions.confirm') }
                                - unless @user.is_admin || false
                                  %i (pour #{distance_of_time_in_words_to_now(journal.created_at + 24.hours)})

        - unless @organization.specific_mission
          .form-group
            .row
              .col-md-6.text-start.notif-booktype
                %span Pré-saisie comptable activée pour le dossier :
                %span.badge{ class: 'bg-' + (@customer.options.is_preassignment_authorized ? 'success fs-origin' : 'danger fs-origin') }
                  = @customer.options.is_preassignment_authorized ? t('yes_value') : t('no_value')
                - unless @customer.options.is_preassignment_authorized
                  %i.margin1left
                    = link_to '(Activer la pré-saisie comptable)', edit_organization_customer_subscription_path(@organization, @customer)
              .col-md-6.text-end.notif-booktype
                = "#{@customer.account_book_types.count}/#{@customer.options.max_number_of_journals} journaux comptables utilisés"
                - if @customer.options.max_number_of_journals < 10
                  %i.text-muted
                    = link_to '(Augmenter le total autorisé de journaux comptables)', edit_organization_customer_subscription_path(@organization, @customer)

        - if @customer.account_book_types.count < @customer.options.max_number_of_journals
          - journals = @organization.account_book_types.order(is_default: :desc, name: :asc)
          = form_tag copy_organization_customer_journals_path(@organization, @customer), method: 'POST', class: 'form-horizontal', id: 'copy_journals' do
            .mb-5
            .form-group
              %label.semibold Ajouter un journal
              = select_tag "journal_ids[]", options_from_collection_for_select(journals, "id", "name"), multiple: true, id: 'copy-journals-into-customer'


            .form-group.no-margin
              .w-100.text-end
                = link_to t('actions.cancel'), organization_customer_path(@organization, @customer, tab: 'journals'), class: 'btn btn-light semibold'
                = submit_tag 'Valider les modifications', class: 'btn btn-primary bold'
      .modal-footer