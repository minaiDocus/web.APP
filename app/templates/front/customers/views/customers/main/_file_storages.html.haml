- external_file_storage = user.find_or_create_external_file_storage.reload
- options = { size: '15', color: 'rgba(26, 26, 26, 0.7);'}

#file_storages_customers
  %table.table.table-striped
    %thead
      %tr
        %th Service
        %th Autorisé ?
        %th Configuré ?
        %th Utilisé ?
        %th Chemin de livraison
        %th.text-end Action
    %tbody.retractable.slidedown
      %tr
        %th Dropbox Extended
        %td.text-center= icon_tag(user.is_dropbox_extended_authorized, options)
        %td.text-center= icon_tag(DropboxExtended.access_token.present?, options)
        %td
        %td= user.dropbox_delivery_folder
        %td.text-end.pointer
          .action
            %span= glyphicon('ellipses', { size: '15', color: 'rgba(26, 26, 26, 0.7);', style: 'transform: rotate(90deg)'})
          .sub_menu.text-start.hide
            %ul.no-margin.no-padding.regular
              - idocus_params = param_encode({ url: '', method: 'POST', datas: { name: 'is_dropbox_extended_authorized' }, html: { target: '#file_storages_customers' } })
              - if not user.is_dropbox_extended_authorized
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-check', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Activé
              - else
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-x', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Désactiver                  
      %tr
        %th Dropbox
        %td.text-center= icon_tag(external_file_storage.is_dropbox_basic_authorized?, options)
        %td.text-center= icon_tag(external_file_storage.dropbox_basic.is_configured?, options)
        %td.text-center= icon_tag(external_file_storage.is_used?(ExternalFileStorage::F_DROPBOX), options)
        %td= external_file_storage.dropbox_basic.path
        %td.text-end.pointer
          .action
            %span= glyphicon('ellipses', { size: '15', color: 'rgba(26, 26, 26, 0.7);', style: 'transform: rotate(90deg)'})
          .sub_menu.text-start.hide
            %ul.no-margin.no-padding.regular
              - idocus_params = param_encode({ url: '', method: 'POST', datas: { name: 'is_dropbox_basic_authorized?' }, html: { target: '#file_storages_customers' } })
              - if not external_file_storage.is_dropbox_basic_authorized?                                
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-check', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Activé
              - else
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-x', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Désactiver                  
      %tr
        %th Google Drive
        %td.text-center= icon_tag(external_file_storage.is_google_docs_authorized?, options)
        %td.text-center= icon_tag(external_file_storage.google_doc.is_configured?, options)
        %td.text-center= icon_tag(external_file_storage.is_used?(ExternalFileStorage::F_GOOGLE_DOCS), options)
        %td= external_file_storage.google_doc.path
        %td.text-end.pointer
          .action
            %span= glyphicon('ellipses', { size: '15', color: 'rgba(26, 26, 26, 0.7);', style: 'transform: rotate(90deg)'})
          .sub_menu.text-start.hide
            %ul.no-margin.no-padding.regular
              - idocus_params = param_encode({ url: '', method: 'POST', datas: { name: 'is_google_docs_authorized?' }, html: { target: '#file_storages_customers' } })
              - if not external_file_storage.is_google_docs_authorized?
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-check', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Activé
              - else
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-x', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Désactiver
      %tr
        %th FTP
        %td.text-center= icon_tag(external_file_storage.is_ftp_authorized?, options)
        %td.text-center= icon_tag(external_file_storage.ftp.is_configured?, options)
        %td.text-center= icon_tag(external_file_storage.is_used?(ExternalFileStorage::F_FTP), options)
        %td= external_file_storage.ftp.path
        %td.text-end.pointer
          .action
            %span= glyphicon('ellipses', { size: '15', color: 'rgba(26, 26, 26, 0.7);', style: 'transform: rotate(90deg)'})
          .sub_menu.text-start.hide
            %ul.no-margin.no-padding.regular
              - idocus_params = param_encode({ url: '', method: 'POST', datas: { name: 'is_ftp_authorized?' }, html: { target: '#file_storages_customers' } })
              - if not external_file_storage.is_ftp_authorized?
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-check', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Activé
              - else
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-x', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Désactiver
      %tr
        %th Box
        %td.text-center= icon_tag(external_file_storage.is_box_authorized?, options)
        %td.text-center= icon_tag(external_file_storage.box.is_configured?, options)
        %td.text-center= icon_tag(external_file_storage.is_used?(ExternalFileStorage::F_BOX), options)
        %td= external_file_storage.box.path
        %td.text-end.pointer
          .action
            %span= glyphicon('ellipses', { size: '15', color: 'rgba(26, 26, 26, 0.7);', style: 'transform: rotate(90deg)'})
          .sub_menu.text-start.hide
            %ul.no-margin.no-padding.regular
              - idocus_params = param_encode({ url: '', method: 'POST', datas: { name: 'is_ftp_authorized?' }, html: { target: '#file_storages_customers' } })
              - if not external_file_storage.is_box_authorized?
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-check', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Activé
              - else
                %li.as_idocus_ajax{ idocus: idocus_params }
                  %span.me-2= glyphicon('circle-x', { size: '15', color: 'rgba(26, 26, 26, 0.7);'})
                  %span Désactiver
