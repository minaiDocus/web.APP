#create_customer.derivationRight
  .card
    .card-header
      %h3
        %center Etape 1 - Création du dossier
    = form_tag customer_form_url(@organization, @customer), method: :post, class: 'simple_form form form-horizontal margin0' do
      .card-body{ style: 'font-size:12px' }
        .row.customer-base-form
          .col-md-6
            .box.bg-light.height_groups.groups_1.clearfix.small-shadow
              %h5 Identification du client
              %hr
              .form-group.clearfix
                .label-section
                  = label_tag 'user[company]', "Nom de la société", class: 'required semibold'
                .control-section
                  .select-container.no-padding.w-100
                    = text_field_tag 'user[company]', nil, class: 'form-control', :required => true, placeholder: "ex : iDocus"
              .form-group.clearfix
                .label-section
                  = label_tag 'user[code]', "Code du dossier", class: 'required semibold'
                .control-section
                  .select-container.no-padding.w-100
                    = text_field_tag 'user[code]', @organization.code.to_s + '%', class: 'form-control', :required => true
                    %i.help-block
                      Doit impérativement commencer par :
                      =@organization.code.to_s + '%'
                      , 15 caractères alphanumériques maximum, code cabinet inclus.
              .form-group.clearfix
                .label-section
                  = label_tag 'user[first_name]', "Prénom", class: 'semibold'
                .control-section
                  .select-container.no-padding.w-100
                    = text_field_tag 'user[first_name]', nil, class: 'form-control'
              .form-group.clearfix
                .label-section
                  = label_tag 'user[last_name]', "Nom", class: 'semibold'
                .control-section
                  .select-container.no-padding.w-100
                    = text_field_tag 'user[last_name]', nil, class: 'form-control'
              .form-group.clearfix
                .label-section
                  = label_tag 'user[phone_number]', "Numéro du téléphone", class: 'semibold'
                .control-section
                  .select-container.no-padding.w-100
                    = text_field_tag 'user[phone_number]', nil, class: 'form-control'
              .form-group.clearfix
                .label-section
                  = label_tag 'user[email]', "Courriel", class: 'required semibold'
                .control-section
                  .select-container.no-padding.w-100
                    = text_field_tag 'user[email]', nil, class: 'form-control', :required => true
                    %i.help-block Le courriel sert d’identifiant à iDocus et de contact principal en cas de besoin de la part d’iDocus
          .col-md-6.back-grey
            .box.bg-light.height_groups.groups_1.clearfix.small-shadow
              %h5 Paramètre de base
              %hr
              - unless @organization.specific_mission
                .form-group.row
                  .col-md-10
                    = label_tag 'user[is_pre_assignement_displayed]', t('activerecord.models.user.attributes.is_pre_assignement_displayed'), class: 'control-label required semibold'
                  .col-md-2.form-check.form-switch
                    = label_tag 'user[is_pre_assignement_displayed]', 'Oui', class: 'semibold'
                    = check_box_tag 'user[is_pre_assignement_displayed]', true, true, class: 'custom-form-inline form-check-input input-toggle'
                .form-group.row
                  .col-md-10
                    = label_tag 'user[act_as_a_collaborator_into_pre_assignment]', t('activerecord.models.user.attributes.act_as_a_collaborator_into_pre_assignment'), class: 'control-label required semibold'
                  .col-md-2.form-check.form-switch
                    = label_tag 'user[act_as_a_collaborator_into_pre_assignment]', 'Oui', class: 'semibold'
                    = check_box_tag 'user[act_as_a_collaborator_into_pre_assignment]', true, true, class: 'custom-form-inline form-check-input input-toggle'              
              .form-group.clearfix
                .label-section
                  = label_tag 'user[group_ids][]', "A quel groupe, le dossier doit-il être attribué ?", class: 'control-label required'
                .control-section
                  = select_tag 'user[group_ids][]', options_from_collection_for_select(@user.groups.order(name: :asc), "id", "name"), class: 'form-control select optional', id: 'select-group-list', include_blank: true, multiple: true
              .form-group.clearfix
                .label-section
                  = label_tag 'user[manager_id]', "Quel est le collaborateur en charge du dossier?", class: 'control-label required'
                .control-section
                  = select_tag 'user[manager_id]', options_for_select(managers_options_for_select), class: 'form-control select optional', id: 'select-customer-list', include_blank: false, multiple: false
                  %i.help-block IMPORTANT! Indiquer le collaborateur en charge du dossier permettra à iDocus de le contacter en cas de soucis. Autrement tous les mails seront adressés à l’administrateur de l’organisation.
              - unless @organization.specific_mission
                .form-group.row
                  .col-md-10
                    = label_tag 'user[options_attributes][is_taxable]', "Le dossier est-il assujetti à TVA?", class: 'control-label required semibold'
                    %br
                    %i.help-block Non (aucune TVA ne sera reportée en pré-saisie).
                  .col-md-2.form-check.form-switch
                    = label_tag 'user[options_attributes][is_taxable]', 'Oui', class: 'semibold'
                    = check_box_tag 'user[options_attributes][is_taxable]', true, true, class: 'custom-form-inline form-check-input input-toggle'
              
              - unless @organization.specific_mission
                %h5 Logiciels comptables utilisés:
                %hr
                .form-group
                  .row
                    .col-md-6
                      - if @organization.try(:ibiza).try(:used?)
                        .form-check
                          = check_box_tag 'user[ibiza_attributes][is_used]', true, false, class: 'form-check-input pointer float-none softwares_setting ibiza-customer-select'
                          %label.ms-1.semibold Ibiza
                    .col-md-6
                      - if @organization.try(:cegid).try(:used?)
                        .form-check
                          = check_box_tag 'user[cegid_attributes][is_used]', true, false, class: 'form-check-input pointer float-none softwares_setting ibiza-customer-select'
                          %label.ms-1.semibold Cegid
                  .row
                    .col-md-6
                      - if @organization.try(:exact_online).try(:used?)
                        .form-check
                          = check_box_tag 'user[exact_online_attributes][is_used]', true, false, class: 'form-check-input pointer float-none softwares_setting'
                          %label.ms-1.semibold Exact Online
                    .col-md-6
                      - if @organization.try(:fec_agiris).try(:used?)
                        .form-check
                          = check_box_tag 'user[fec_agiris_attributes][is_used]', true, false, class: 'form-check-input pointer float-none'
                          %label.ms-1.semibold Fec Agiris

                  .row
                    .col-md-6
                      - if @organization.try(:coala).try(:used?)
                        .form-check
                          = check_box_tag 'user[coala_attributes][is_used]', true, false, class: 'form-check-input pointer float-none'
                          %label.ms-1.semibold Coala
                    .col-md-6
                      - if @organization.try(:csv_descriptor).try(:used?)
                        .form-check
                          = check_box_tag 'user[csv_descriptor_attributes][is_used]', true, false, class: 'form-check-input pointer float-none'
                          %label.ms-1.semibold Format d’export .csv
                  .row
                    .col-md-6
                      - if @organization.try(:quadratus).try(:used?)
                        .form-check
                          = check_box_tag 'user[quadratus_attributes][is_used]', true, false, class: 'form-check-input pointer float-none'
                          %label.ms-1.semibold Quadratus
                    .col-md-6
                      - if @organization.try(:my_unisoft).try(:used?)
                        .form-check
                          = check_box_tag 'user[my_unisoft_attributes][is_used]', true, false, class: 'form-check-input pointer float-none'
                          %label.ms-1.semibold My Unisoft
                  .row
                    .col-md-6
                      - if @organization.try(:sage).try(:used?)
                        .form-check
                          = check_box_tag 'user[sage_attributes][is_used]', true, false, class: 'form-check-input pointer float-none'
                          %label.ms-1.semibold Sage
                .form-group
                  - if @organization.try(:ibiza).try(:used?)
                    %label.semibold Dossier correspondant dans iBiZa
                    = select_tag 'user[ibiza_attributes][ibiza_id]', nil, class: 'form-control select optional ibiza-customers-list', id: 'ibiza-customers-lists', placeholder: 'Choisir un dossier', data: { original_value: nil, users_list_url: organization_ibiza_users_path(@organization, format: 'json') }, multiple: false
        %br
        .row.subscription-base-form
          - unless @organization.specific_mission
            = render 'subscription_options'

      .card-footer
        .form-actions
          .for_submit
            .submit
              %center
                - if @organization.specific_mission
                  = submit_tag 'Créer', class: 'btn btn-primary small-shadow text-bold'
                - else
                  = submit_tag 'Créer et paramètrer la comptabilité', class: 'btn btn-primary small-shadow text-bold'
                  %span.text-bold= glyphicon('chevron-right', { color: '#007bff' })