= stylesheet_link_tag 'front/customers/assets/stylesheets/main'

.customers
  %input#organization_id{type: :hidden, value: @organization.id, name: 'organization_id'}
  .list-customers.derivationRight
    .row
      .col-md-6
        %h3.bold
          Liste des clients
          %span.badge.badge-secondary.badge-sm.regular= @customers.total_count
      .col-md-3.no-padding
        .input-group.mb-3
          %span.input-group-text#basic-addon1= glyphicon('magnifying-glass', { size: '16', color: 'background: rgba(26, 26, 26, 0.7)' })          
          %input.form-control{ type: :text, "aria-label" => "Rechercher", "aria-describedby" => "basic-addon1"  }
      .col-md-1.text-center.no-padding
        %button.btn.btn-light.customer-filter.semibold
          %span Filtrer
          %span= glyphicon('transfer', { size: '16', color: '#72AA42', style: 'transform: rotate(90deg)'})
      .col-md-2.no-padding
        - if (@user.leader? || @user.manage_customers) && @organization.is_active
          %button.btn.btn-primary.new-customer.semibold.add-edit
            %span.me-2= glyphicon('plus', { size: '15', color: '#FFFF'})
            %span Nouveau Client
          
        
    .box
      .row
        .col-md-12
          %table.table.table-striped.table_integration
            %thead
              %th Nom
              %th Identifiant
              %th Date
              %th Forfait
              %th Pré-affectation
              %th Automates
              %th Journaux sup.
              %th.text-end Action
            %tbody
              - @customers.each do |customer|
                %tr
                  %td.align-middle= customer.name
                  %td.align-middle
                    %span.info
                      = link_to customer, organization_customer_path(@organization, customer)
                  %td.align-middle= customer.created_at.strftime('%d/%m/%Y')
                  %td.align-middle
                    - period = @periods.select { |e| e.user == customer }.first
                    - if period
                      - period.product_option_orders.each do |option|
                        %span.semibold= option.group_title
                        - if option.title.present?
                          %br
                          %i= option.title
                  %td.text-center.align-middle= customer.subscription.is_package?('pre_assignment_option') ? 'Activé' : '-'
                  %td.text-center.align-middle= customer.subscription.is_package?('retriever_option') ? "Récupération banque +\nFactures sur Internet" : "-"
                  %td.align-middle= customer.subscription.number_of_journals
                  %td.text-end.pointer.align-middle
                    .action.sub_edit_delete.list-collaborators
                      %span.glyph= glyphicon('ellipses', { size: '15', color: 'rgba(26, 26, 26, 0.7);', style: 'transform: rotate(90deg)'})
                    .sub_menu.text-start.hide
                      %ul.no-margin.no-padding.regular
                        %li.edit.edit-customer
                          = link_to glyphicon('pencil', { size: '15', color: 'rgba(26, 26, 26, 0.7);'}) + ' Editer', organization_customer_path(@organization, customer)
                        %li.delete.red-label
                          = link_to glyphicon('ban', { size: '15', color: "#FF4848" }) + ' Clôturer le dossier', account_close_confirm_organization_customer_path(@organization, customer)


.modal#customers-filter
  .modal-dialog
    .modal-content
      .modal-header
        %h5.modal-title.bold Filtrer les clients
        %button.btn-close{'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', :type => 'button'}
      .modal-body
        .form-group
          %label.semibold Filtrer par groupe
          %select.form-control#group-filter{ name: 'group-filter', multiple: true }              
            %option{ value: 'grp-1'} Groupe 1
            %option{ value: 'grp-2'} Groupe 2

        .form-group
          %label.semibold Filtrer par collaborateur
          %select.form-control#collaborator-filter{ name: 'collaborator-filter', multiple: true }              
            %option{ value: 'colab-1'} Collab 1
            %option{ value: 'colab-2'} Collab 2

        .form-group.row
          .col-md-10
            %label.semibold Dossier cloturé ?
          .col-md-2.form-check.form-switch
            %label.form-check-label Oui
            %input.form-check-input{ type: :checkbox, checked: true }
        
      .modal-footer
        %button.btn.btn-light.semibold.cancel{ type: :button } Annuler
        %button.btn.btn-primary.semibold{ type: :button, disabled: true } Filtrer

.modal#create-customer
  .modal-dialog
    .modal-content


= javascript_include_tag 'front/customers/assets/javascripts/main'