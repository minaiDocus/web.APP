.ibizabox_content
  #ibizabox_folders_list.box.derivationLeft{"aria-labelledby" => "ibizabox_folders_list_tab", role: "tabpanel", class: ('active show' if (params[:tab] == 'ibiza_box' && (params[:subtab].blank? || params[:subtab] == 'ibizabox_folders_list')))}
    .row
      .col-md-10
        %h5
          Liste des répertoires accessibles
          %span.badge.bg-secondary= @customer.ibizabox_folders.count
      .col-md-2.float-end.no-padding
        = link_to 'Rafraîchir', refresh_organization_customer_ibizabox_folders_path(@organization, @customer), method: :patch, class: 'btn btn-primary margin1right'

    %table.table.table-striped.table-condensed.margin1bottom.table-bordered-inner.table-detachable-head
      %thead
        %tr.bg-brown.text-white
          %th Code journal idocus
          %th Répertoire Ibiza
          %th Périodes accessibles
          %th Statut
          %th Actions
      %tbody.retractable.slidedown
        - ibiza_journals = FileImport::Ibizabox.get_accessible_journals(@customer)
        - @customer.ibizabox_folders.includes(:journal).each do |folder|
          - journal = folder.journal
          %tr
            %td
              = journal.name
              - unless ibiza_journal_accessible?(folder, ibiza_journals)
                %i
                  %strong (Journal inexistant ou inaccessible depuis la ged ibiza)
            %td= journal.use_pseudonym_for_import ? journal.pseudonym : journal.name
            %td= FileImport::Ibizabox.new(folder).accessible_ibiza_periods.join(" - ")
            %td= ibizabox_folder_state(folder)
            %td
              - if ibiza_journal_accessible?(folder, ibiza_journals)
                = link_to "#{folder.active? ? 'Désactiver' : 'Activer'}", organization_customer_ibizabox_folder_path(@organization, @customer, folder), method: 'patch', class: "btn btn-light btn-#{folder.active? ? 'danger' : 'primary'}"
              - else
                = link_to "Journal ibiza inaccessible", '#', class: "btn btn-light btn-primary", disabled: true

  #ibizabox_documents_historic.box.derivationRight{ link: organization_customer_ibizabox_documents_path(@organization, @customer)}
    .historic_content

  #select_ibizabox_documents.box.derivationLeft{ link: select_organization_customer_ibizabox_documents_path(@organization, @customer) }
    .select_content

= javascript_include_tag 'front/ibiza/assets/javascripts/box_document'