= stylesheet_link_tag 'front/organizations/assets/stylesheets/show'
= stylesheet_link_tag 'front/paper_set_orders/assets/stylesheets/main'

%input#organization_id{type: :hidden, value: @organization.id, name: 'organization_id'}
- manual_paper_set_order = CustomUtils.is_manual_paper_set_order?(@organization) ? true : false
%input#manual_paper_set_order{type: :hidden, value: "#{manual_paper_set_order}", view: (manual_paper_set_order ? select_organization_file_sending_kit_path(@organization) : select_for_orders_organization_paper_set_orders_path), name: 'manual_paper_set_order'}

.kits.paper-set-order-view
  .row.derivationRight
    .col-md-8
      %h3.bold
        Kit courrier
        %span.badge.badge-secondary.badge-sm.regular= @orders_count
    .col-md-4.text-end
      %button.btn.btn-primary.select_for_orders.semibold
        Nouvelle commande

  .box.mt-4.derivationLeft
    %table.table.table-striped
      %thead
        %th Dossier
        %th Date de commande
        %th Société
        %th Commande
        %th= t('activerecord.models.paper_process.attributes.tracking_number').downcase
        %th= t('activerecord.models.order.attributes.state').downcase
        %th.text-end Action
      %tbody
        - @orders.each do |order|
          %tr
            %td.text-table-green.semibold= link_to "#{order.user.info}", organization_customer_path(@organization, order.user_id, tab: 'orders')
            %td= order.created_at.strftime('%d/%m/%y')
            %td= truncate(order.company, length: 20, separator: ' ')
            %td
              = order.paper_set_casing_size.to_s + 'g - ' + order.paper_set_casing_count.to_s + ' env - ' + order.paper_set_folder_count.to_s + ' chm - '
              = paper_set_date_to_name(order.period_duration, order.paper_set_start_date)
              à
              = paper_set_date_to_name(order.period_duration, order.paper_set_end_date)
            %td.text-table-green= link_to_paper_tracking(order.kit) if order.kit.try(:tracking_number)
            %td
              .badge.bg-dark.semibold= Order.state_machine.states[order.state].human_name
            %td.text-end.pointer
              .action.sub-menu-kit
                %span= glyphicon('ellipses', { size: '15', color: 'rgba(26, 26, 26, 0.7);', style: 'transform: rotate(90deg)'})
              .sub_menu.text-start.hide
                %ul.no-margin.no-padding.regular
                  %li.add
                    = link_to glyphicon('plus', { size: '15', color: 'rgba(26, 26, 26, 0.7);'}) + ' Recommander', new_organization_paper_set_order_path(@organization, template: order), title: 'Recommander le même kit'
                  - if order.pending? && (Time.now < order.created_at + 24.hours)
                    %li.edit.edit-paper-set-order
                      = link_to glyphicon('pencil', { size: '15', color: 'rgba(26, 26, 26, 0.7);'}) + ' Éditer', edit_organization_paper_set_order_path(@organization, order), title: 'Éditer'
                    %li.delete.red-label
                      = link_to glyphicon('trash', { size: '15', color: "#FF4848" }) + ' Supprimer', organization_paper_set_order_path(@organization, order), method: :delete, data: { confirm: t('actions.confirm') }, title: 'Supprimer'
    = render file: Rails.root.join('app/views/shared/_pagination.html.haml'), locals: { name: 'paper_set_orders', total_pages: @orders.total_pages }
          
  .mb-5

.modal.fade#select_for_orders
  .modal-dialog{:role => 'document'}
    .modal-content
      .modal-header
        - if manual_paper_set_order
          %h5.modal-title.bold Sélection des options du kit d'envoi de numérisation
        - else
          %h5.modal-title.bold Sélection des options du kit d'envoi de documents
        %button.btn-close{'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', :type => 'button'}
      .modal-body.back-grey
        Chargement ...
      .modal-footer
        %button.btn.btn-light.semibold.cancel{ 'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', type: :button } Annuler
        = link_to t('actions.edit'), '#', link: edit_organization_file_sending_kit_path(@organization), class: 'btn btn-dark bold edit-file-sending-kits' if current_user.is_developer
        - if manual_paper_set_order 
          %input.btn.btn-primary.bold.generate-manual-paper-set-order{:type => 'submit', name: 'commit', value: 'Générer', id: 'generate-manual-paper-set-order', 'data-disable-with' => 'Générer'}
        - else
          %input.btn.btn-primary.valid-paper-set-order{:type => 'submit', name: 'commit', value: 'Commander', id: 'valid-paper-set-order', 'data-disable-with' => 'Commander'}

.modal.fade#create_order_multiple
  .modal-dialog{:role => 'document', style: 'min-width: 1024px'}
    .modal-content
      .modal-header
        Commande multiple de Kit Courriers
        %button.btn-close{'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', :type => 'button'}
      .modal-body
        Chargement ...
      .modal-footer
        %button.btn.btn-light.semibold.cancel{ 'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', type: :button } Annuler
        %input.btn.btn-primary.create-paper-set-order-multiple{:type => 'submit', name: 'commit', value: 'Commander', id: 'create-paper-set-order-multiple', 'data-disable-with' => 'Commander', class: "btn btn-primary#{' valid-manual-paper-set-order' if manual_paper_set_order}"}


.modal.fade#add-new-paper-set-order
  .modal-dialog{:role => 'document'}
    .modal-content
      .modal-header
        %h5.modal-title.bold Commande de Kit envoi courrier
        %button.btn-close{'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', :type => 'button'}
      .modal-body.back-grey
        Chargement ...
      .modal-footer
        %button.btn.btn-light.semibold.cancel{ 'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', type: :button } Annuler
        %input.btn.btn-primary.add-paper-set-order{:type => 'submit', name: 'commit', value: 'Commander', id: 'add-paper-set-order', 'data-disable-with' => 'Commander'}

.modal.fade#file_sending_kits_edit
  .modal-dialog{:role => 'document'}
    .modal-content
      .modal-header
        %h5.modal-title.bold Edition du kit d'envoi de documents
        %button.btn-close{'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', :type => 'button'}
      .modal-body.back-grey#file_sending_kits_edit_body
        Chargement ...
      .modal-footer
        %button.btn.btn-light.semibold.cancel{ 'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', type: :button } Annuler
        %button.btn.btn-primary.bold.validate_file_sending_kits_edit{ type: :button} Valider les modifications


.modal#edit-kit-box
  .modal-dialog
    .modal-content
      .modal-header
        %h5.modal-title.bold Modifications
        %button.btn-close{'aria-label' => 'Close', 'data-bs-dismiss' => 'modal', :type => 'button'}
      .modal-body
        .form-group
          %label.semibold Dossier          
          .select-container.no-padding.w-100
            %input{ placeholder: "IDOC%002 - support - John Doe" }

        .form-group
          %label.semibold Date de commande      
          .select-container.no-padding.w-100
            %input{ placeholder: "25/11/20" }

        .form-group
          %label.semibold Société        
          .select-container.no-padding.w-100
            %input{ placeholder: "iDocus" }

        .form-group
          %label.semibold Commande       
          .select-container.no-padding.w-100
            %input{ placeholder: "34" }


        .form-group
          %label.semibold N° de suivi      
          .select-container.no-padding.w-100
            %input{ placeholder: "43256488879" }


        .form-group
          %label.semibold Statut         
          %select.form-control#kit-state{ name: 'kit-state', multiple: false }              
            %option En transit
            %option Reçu

      .modal-footer
        %button.btn.btn-light.semibold.cancel{ type: :button } Annuler        
        %button.btn.btn-primary.semibold{ type: :button } Valider les modifications

= javascript_include_tag 'front/paper_set_orders/assets/javascripts/main'