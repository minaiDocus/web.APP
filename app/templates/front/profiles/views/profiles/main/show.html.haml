= stylesheet_link_tag 'front/profiles/assets/stylesheets/main'

.container-fluid
  .row.derivationRight
    .col-md-12.retractable-content
      - unless organizations_suspended? && @user.active?
        %button.btn.btn-light.semibold.change-password
          %span.me-3= glyphicon('layers', { size: '15', color: '#72AA42'})
          %span Changer mot de passe

        - if @user.active? && !@user.is_prescriber && @user.organization.is_active
          = render file: Rails.root.join('app/templates/front/account_sharings/views/account_sharings/main/_show.html.haml')

          - if 1 == 1 || @user.is_guest
            = render file: Rails.root.join('app/templates/front/addresses/views/addresses/_show.html.haml')

      - if @user.active?
        - if @user.organization.is_active
          - unless organizations_suspended?
            %button.btn.btn-light.semibold.external-file-storage
              %span.me-3= glyphicon('layers', { size: '15', color: '#72AA42'})
              %span Stockage externes

            = render file: Rails.root.join('app/templates/front/dematboxes/views/dematboxes/_show.html.haml')

            #subscription_options.row
              .col-md-12
                = simple_form_for true_user, url: profiles_path, html: { id: 'subscription_options' } do |f|
                  %input{ type: 'hidden', name: 'user[h_change_notifications]', value: 'true' }
                  .card
                    .card-header
                      %h3 Notifications et remontées d'alertes
                    .card-body
                      = render partial: 'notifications', locals: { f: f }
                    .card-footer
                      .form-actions
                        %button.btn.btn-primary#validate_notification_options{ type: 'button'} Valider

            - if @user.options.try(:is_upload_authorized) && !(@user.is_admin || @user.is_prescriber || @user.inactive?)
              - period_service = Billing::Period.new user: @user, current_time: Time.now.beginning_of_month
              #emailed_documents.row
                .col-md-12
                  .card
                    .card-header
                      %h3 Adresse email d'envoi de documents
                    .card-body
                      .row
                        .col-md-6
                          Vous pouvez envoyer vos pièces comptables par mail.
                          %br
                          La plateforme iDocus intégrera les pièces jointes (#{UploadedDocument.valid_extensions}) de votre mail.
                          %br
                          %br
                          %h4 Règles d'utilisation :
                          %ul
                            %li
                              Format de l’objet du mail : [libellé court du journal comptable] [période]
                              - if @user.account_book_types.first && period_service.names.first
                                %br
                                exemple :
                                %b
                                  %i #{@user.account_book_types.first.name} #{period_service.names.first}
                            %li
                              La somme des tailles des pièces jointes de votre mail ne doit pas dépasser
                              %b 10 Mo
                              \.
                        .col-md-6
                          %h4 Vos journaux comptables accessibles :
                          %ul
                            - @user.account_book_types.each do |journal|
                              %li
                                %b= journal.name
                                = "(#{journal.description.sub(/\A\s*\(/,'').sub(/\)\s*\z/,'')})"
                          %h4 Vos périodes actuellement accessibles :
                          %ul
                            - period_service.names.each do |name|
                              %li
                                %b= name
                      .row
                        .col-md-12
                          Voici votre adresse personnalisée à laquelle vous devez envoyer vos pièces :
                          %b{ style: 'font-size: 16px;' }
                            = "#{@user.email_code}@fw.idocus.com"
                          = link_to 'Générer une nouvelle adresse', email_code_profiles_path, class: 'btn btn-mini btn-primary', data: { method: :post }, style: 'position:relative;top:-2px;'

        - if !@user.organization.is_active && @user.leader?
          #active_organization.row
            .col-md-12
              .card
                .card-header
                  %h3 Réactiver mon compte client
                .card-body
                  Pour réactiver votre compte client veuillez envoyer un courriel à
                  = link_to 'commercial@idocus.com', 'mailto:commercial@idocus.com'


= render partial: 'dialogs'
= javascript_include_tag 'front/profiles/assets/javascripts/main'
